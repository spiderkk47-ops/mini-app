<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zephurium Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .language-switcher {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        .currency-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .currency-item {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .currency-amount {
            font-size: 1.5em;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .energy-bar {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        .energy-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 20px;
            border-radius: 10px;
            margin: 5px 0;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .energy-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        .tab-buttons {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab-button {
            flex: 1;
            background: none;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
            font-size: 0.9em;
        }
        
        .tab-button.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .section {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .section.active {
            display: block;
        }
        
        /* Кликер секция */
        .coin {
            width: 180px;
            height: 180px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #B8860B);
            border-radius: 50%;
            margin: 20px auto;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.6),
                inset 0 -10px 20px rgba(0,0,0,0.4),
                inset 0 10px 20px rgba(255,255,255,0.3);
            transition: transform 0.1s;
            user-select: none;
            position: relative;
            overflow: hidden;
        }
        
        .coin::before {
            content: "₿";
            position: absolute;
            font-size: 3em;
            color: #8B7500;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .coin:active {
            transform: scale(0.92);
        }
        
        .coin:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }
        
        .upgrade-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .upgrade-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* NFT категории */
        .nft-categories {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .nft-category {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s;
            min-width: 80px;
        }
        
        .nft-category.active {
            transform: scale(1.05);
            box-shadow: 0 0 10px currentColor;
        }
        
        .nft-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .nft-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .nft-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .nft-item.owned {
            border-color: #4CAF50;
        }
        
        .nft-image {
            font-size: 2.5em;
            margin-bottom: 8px;
            filter: drop-shadow(0 0 5px currentColor);
        }
        
        /* Кнопки */
        .ad-button {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none;
            color: #333;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
            transition: transform 0.2s;
        }
        
        .ad-button:hover {
            transform: translateY(-2px);
        }
        
        .ad-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Поля ввода */
        .exchange-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            color: white;
            width: 100%;
            margin: 5px 0;
        }
        
        .exchange-input:focus {
            outline: none;
            border-color: #FFD700;
        }
        
        /* Цвета для категорий NFT */
        .common { background: linear-gradient(135deg, #78909C, #546E7A); color: #ECEFF1; }
        .uncommon { background: linear-gradient(135deg, #66BB6A, #43A047); color: #E8F5E8; }
        .rare { background: linear-gradient(135deg, #42A5F5, #1976D2); color: #E3F2FD; }
        .epic { background: linear-gradient(135deg, #FFA726, #F57C00); color: #FFF3E0; }
        .legendary { background: linear-gradient(135deg, #AB47BC, #8E24AA); color: #F3E5F5; }
        
        /* PVP секция */
        .pvp-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        .battle-arena {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }
        
        .fighter {
            text-align: center;
            flex: 1;
        }
        
        .fighter-image {
            font-size: 3em;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
        }
        
        .health-bar {
            background: #333;
            border-radius: 10px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .health-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            transition: width 0.3s;
        }
        
        .enemy-health-fill {
            background: linear-gradient(90deg, #f44336, #ff9800);
        }
        
        .vs {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 15px;
            color: #FFD700;
        }
        
        .battle-log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            max-height: 100px;
            overflow-y: auto;
            font-size: 0.9em;
            text-align: left;
        }
        
        .battle-message {
            margin: 2px 0;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .player-message {
            background: rgba(76, 175, 80, 0.2);
            color: #8BC34A;
        }
        
        .enemy-message {
            background: rgba(244, 67, 54, 0.2);
            color: #ff9800;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px) scale(1.5);
            }
        }
        
        @keyframes battleHit {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💎 Zephurium Game</h1>
            <p>Крипто-кликер с PVP боями!</p>
            <button class="language-switcher" onclick="switchLanguage()" id="languageBtn">RU</button>
        </div>
        
        <div class="currency-display">
            <div class="currency-item">
                <div>💰 Монеты</div>
                <div class="currency-amount" id="balance">0</div>
            </div>
            <div class="currency-item">
                <div>💎 Алмазы</div>
                <div class="currency-amount" id="diamonds">0</div>
            </div>
        </div>
        
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('clicker')">🎮 Кликер</button>
            <button class="tab-button" onclick="showTab('referral')">👥 Рефы</button>
            <button class="tab-button" onclick="showTab('ads')">📺 Реклама</button>
            <button class="tab-button" onclick="showTab('exchange')">💱 Обмен</button>
            <button class="tab-button" onclick="showTab('nft')">🖼️ NFT</button>
            <button class="tab-button" onclick="showTab('pvp')">⚔️ PVP</button>
        </div>
        
        <!-- Секция Кликер -->
        <div class="section active" id="clickerSection">
            <div class="energy-bar">
                <div>⚡ Энергия: <span id="currentEnergy">25000</span>/<span id="maxEnergy">25000</span></div>
                <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                <small>Восстановление: 240/мин</small>
            </div>
            
            <div class="coin" onclick="clickCoin()" id="coin"></div>
            <div style="text-align: center; margin: 10px 0;">
                <strong>Кликай по крипто-монете!</strong><br>
                <small>+<span id="coinsPerClick">1</span> монет за клик (-2⚡)</small>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div>🎯 Кликов</div>
                    <div id="clickCount">0</div>
                </div>
                <div class="stat-item">
                    <div>⚡ За клик</div>
                    <div>+<span id="clickPower">1</span></div>
                </div>
            </div>
            
            <h3>🛠️ Улучшения</h3>
            <div class="upgrade-item" onclick="buyUpgrade('click')">
                <strong>⚡ Усилитель клика</strong><br>
                <small>+1 монета за клик</small><br>
                <strong>Цена: 100 монет</strong>
            </div>
            <div class="upgrade-item" onclick="buyUpgrade('auto_click')">
                <strong>🤖 Автокликер</strong><br>
                <small>Уровень: <span id="autoClickLevel">0</span>/1000</small><br>
                <small>+<span id="autoClickPower">0</span> монет/сек</small><br>
                <strong>Цена: 500 монет</strong>
            </div>
        </div>
        
        <!-- Секция Рефералы -->
        <div class="section" id="referralSection">
            <h3>👥 Реферальная система</h3>
            <p>Приглашай друзей и получай бонусы!</p>
            
            <div class="pvp-item">
                <h4>🔗 Твоя реферальная ссылка</h4>
                <input type="text" class="exchange-input" id="referralLink" readonly>
                <button class="ad-button" onclick="copyReferralLink()">
                    📋 Скопировать ссылку
                </button>
            </div>
            
            <div class="pvp-item">
                <h4>📊 Статистика</h4>
                <div class="stats">
                    <div class="stat-item">
                        <div>👥 Приглашено</div>
                        <div id="referralCount">0</div>
                    </div>
                    <div class="stat-item">
                        <div>💰 Бонусы</div>
                        <div>50 монет</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Секция Реклама -->
        <div class="section" id="adsSection">
            <h3>📺 Просмотр рекламы</h3>
            <p>Смотри рекламу и получай монеты!</p>
            
            <div class="pvp-item">
                <h4>🎬 Доступные видео</h4>
                <button class="ad-button" onclick="watchAd()" id="adButton">
                    📺 Посмотреть рекламу (+15 монет)
                </button>
                <div class="stats" style="margin-top: 15px;">
                    <div class="stat-item">
                        <div>📺 Просмотрено</div>
                        <div id="adsWatched">0</div>
                    </div>
                    <div class="stat-item">
                        <div>💰 Заработано</div>
                        <div id="adsEarned">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Секция Обмен -->
        <div class="section" id="exchangeSection">
            <h3>💱 Обмен валют</h3>
            <p>Обменивай монеты на алмазы и обратно!</p>
            
            <div class="pvp-item">
                <h4>💎 Монеты → Алмазы</h4>
                <p>Курс: 100,000 монет = 1 алмаз</p>
                <input type="number" class="exchange-input" id="coinsToDiamonds" placeholder="Количество алмазов" min="1">
                <button class="ad-button" onclick="exchangeCurrency('coins_to_diamonds')">
                    💱 Обменять на алмазы
                </button>
            </div>
            
            <div class="pvp-item">
                <h4>💰 Алмазы → Монеты</h4>
                <p>Курс: 1 алмаз = 100,000 монет</p>
                <input type="number" class="exchange-input" id="diamondsToCoins" placeholder="Количество алмазов" min="1">
                <button class="ad-button" onclick="exchangeCurrency('diamonds_to_coins')">
                    💱 Обменять на монеты
                </button>
            </div>
        </div>
        
        <!-- Секция NFT -->
        <div class="section" id="nftSection">
            <h3>🖼️ NFT Коллекция</h3>
            <p>Приобретай NFT для PVP сражений!</p>
            
            <div class="nft-categories" id="nftCategories">
                <div class="nft-category common active" onclick="filterNFTs('common')">Common</div>
                <div class="nft-category uncommon" onclick="filterNFTs('uncommon')">Uncommon</div>
                <div class="nft-category rare" onclick="filterNFTs('rare')">Rare</div>
                <div class="nft-category epic" onclick="filterNFTs('epic')">Epic</div>
                <div class="nft-category legendary" onclick="filterNFTs('legendary')">Legendary</div>
            </div>
            
            <div class="nft-grid" id="nftGrid">
                <!-- NFT будут добавлены через JavaScript -->
            </div>
            
            <h4 style="margin-top: 20px;">🎪 Ваша коллекция</h4>
            <div class="nft-grid" id="myNftGrid">
                <!-- Приобретенные NFT -->
            </div>
        </div>
        
        <!-- Секция PVP -->
        <div class="section" id="pvpSection">
            <h3>⚔️ PVP Сражения</h3>
            <p>Сражайся с другими игроками!</p>
            
            <div class="pvp-item">
                <h4>🎯 Статистика</h4>
                <div class="stats">
                    <div class="stat-item">
                        <div>🏆 Побед</div>
                        <div id="pvpWins">0</div>
                    </div>
                    <div class="stat-item">
                        <div>💔 Поражений</div>
                        <div id="pvpLosses">0</div>
                    </div>
                </div>
            </div>
            
            <div class="pvp-item">
                <h4>⚔️ Начать битву</h4>
                <p>Выбери NFT для сражения:</p>
                <select class="exchange-input" id="selectedNft">
                    <option value="">Выбери NFT</option>
                </select>
                <button class="ad-button" onclick="startPvP()" id="pvpButton">
                    🔍 Искать противника
                </button>
            </div>
            
            <div class="pvp-item" id="battleArena" style="display: none;">
                <h4>🎪 Арена</h4>
                <div class="battle-arena">
                    <div class="fighter">
                        <div class="fighter-image" id="playerFighter">⚔️</div>
                        <div>Вы</div>
                        <div>⚔️ <span id="playerAttack">0</span> ❤️ <span id="playerHealthText">100</span></div>
                        <div class="health-bar">
                            <div class="health-fill" id="playerHealth" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="vs">VS</div>
                    <div class="fighter">
                        <div class="fighter-image" id="enemyFighter">🐲</div>
                        <div id="enemyName">Противник</div>
                        <div>⚔️ <span id="enemyAttack">0</span> ❤️ <span id="enemyHealthText">100</span></div>
                        <div class="health-bar">
                            <div class="health-fill enemy-health-fill" id="enemyHealth" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="battle-log" id="battleLog">
                    <!-- Лог битвы -->
                </div>
                
                <button class="ad-button" onclick="nextBattleTurn()" id="battleButton">
                    🎯 Атаковать!
                </button>
            </div>
        </div>
    </div>

    <script>
        // ... (весь JavaScript код остается таким же, как в вашем файле)
        // Добавьте только недостающие функции:

        function switchLanguage() {
            const languages = ['RU', 'ENG', 'DE'];
            const currentLang = userData.language;
            const currentIndex = languages.indexOf(currentLang);
            const nextIndex = (currentIndex + 1) % languages.length;
            userData.language = languages[nextIndex];
            
            saveUserData();
            updateUI();
            
            tg.sendData(JSON.stringify({
                type: 'language_change',
                language: userData.language
            }));
        }

        function copyReferralLink() {
            const link = `https://t.me/${tg.initDataUnsafe.user?.username || 'your_bot'}?start=${tg.initDataUnsafe.user?.id || '123'}`;
            navigator.clipboard.writeText(link).then(() => {
                tg.showPopup({
                    title: '✅ Успех',
                    message: 'Реферальная ссылка скопирована!',
                    buttons: [{ type: 'ok' }]
                });
            });
        }

        function watchAd() {
            userData.balance += 15;
            userData.adsWatched++;
            userData.adsEarned += 15;
            
            saveUserData();
            updateUI();
            
            tg.showPopup({
                title: '📺 Реклама просмотрена!',
                message: '+15 монет добавлено на ваш баланс',
                buttons: [{ type: 'ok' }]
            });
            
            tg.sendData(JSON.stringify({
                type: 'ad_watched',
                reward: 15
            }));
        }

        function exchangeCurrency(direction) {
            let amount;
            if (direction === 'coins_to_diamonds') {
                amount = parseInt(document.getElementById('coinsToDiamonds').value) || 0;
                if (amount <= 0) {
                    tg.showPopup({
                        title: '❌ Ошибка',
                        message: 'Введите корректное количество',
                        buttons: [{ type: 'ok' }]
                    });
                    return;
                }
                
                const coinsNeeded = amount * 100000;
                if (userData.balance >= coinsNeeded) {
                    userData.balance -= coinsNeeded;
                    userData.diamonds += amount;
                    saveUserData();
                    updateUI();
                    
                    tg.sendData(JSON.stringify({
                        type: 'exchange',
                        direction: 'coins_to_diamonds',
                        amount: amount
                    }));
                } else {
                    tg.showPopup({
                        title: '❌ Недостаточно средств',
                        message: `Нужно ${coinsNeeded.toLocaleString()} монет`,
                        buttons: [{ type: 'ok' }]
                    });
                }
            } else {
                amount = parseInt(document.getElementById('diamondsToCoins').value) || 0;
                if (amount <= 0) {
                    tg.showPopup({
                        title: '❌ Ошибка',
                        message: 'Введите корректное количество',
                        buttons: [{ type: 'ok' }]
                    });
                    return;
                }
                
                if (userData.diamonds >= amount) {
                    userData.diamonds -= amount;
                    userData.balance += amount * 100000;
                    saveUserData();
                    updateUI();
                    
                    tg.sendData(JSON.stringify({
                        type: 'exchange',
                        direction: 'diamonds_to_coins',
                        amount: amount
                    }));
                } else {
                    tg.showPopup({
                        title: '❌ Недостаточно алмазов',
                        message: `Нужно ${amount} алмазов`,
                        buttons: [{ type: 'ok' }]
                    });
                }
            }
        }

        // Остальной JavaScript код оставьте без изменений
        // ... (весь остальной код из вашего файла)
    </script>
</body>
</html>